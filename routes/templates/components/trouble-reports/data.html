{{$pageData := .}} {{if ne (len $pageData.TroubleReports) 0}}
<ul id="data">
    <style>
        pre {
            text-wrap: wrap;
        }
    </style>

    {{range $troubleReport := $pageData.TroubleReports}}
    {{$id := print "trouble-report-" $troubleReport.ID}}
    <details
        id="{{$id}}"
        class="data"
        style="margin: var(--ui-spacing) auto"
    >
        <summary>{{$troubleReport.Title}}</summary>
        <pre>{{$troubleReport.Content}}</pre>
    </details>

    <div class="actions flex row gap justify-end align-center">
        <button
            hx-get="./trouble-reports/modifications/{{$troubleReport.ID}}"
            hx-trigger="click"
            hx-target="#data"
            hx-swap="outerHTML"
            class="ghost secondary icon"
        >
            <i class="bi bi-clock-history"></i>
        </button>

        <button
            hx-get="./trouble-reports/dialog-edit?id={{$troubleReport.ID}}"
            hx-trigger="click"
            hx-target="#dialogEdit"
            hx-swap="outerHTML"
            class="ghost icon"
            style="color: green;"
        >
            <i class="bi bi-pen"></i>
        </button>

        {{if $pageData.User.IsAdmin}}
        <button
            hx-delete="./trouble-reports/data?id={{$troubleReport.ID}}"
            hx-trigger="click"
            hx-target="#data"
            hx-swap="outerHTML"
            class="ghost destructive icon"
        >
            <i class="bi bi-trash"></i>
        </button>

        {{else}}
        <!-- TODO: User is not an admin, Add voting system for deleting trouble reports -->
        <!-- TODO: Store this vote somewhere and highlight it somehow -->

        <button
            id="voteForDelete"
            hx-post="./trouble-reports/vote?id={{$troubleReport.ID}}&mode=delete"
            hx-trigger="click"
            hx-swap="outerHTML"
            class="ghost destructive flex column justify-between align-center"
            style="transform: scale(0.75);"
        >
            <i class="bi bi-trash"></i>
            <small>VOTE</small>
        </button>
        {{end}}
    </div>
    <hr />
    {{end}}

    <script>
        (() => {
            if (!location.hash) return

            const el = document.querySelector(location.hash);
            if (!el) return;

            el.open = true;
        })();
    </script>
</ul>
{{else}}
<span id="data"></span>
{{end}}
