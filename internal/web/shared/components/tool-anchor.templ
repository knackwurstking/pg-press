package components

import (
	"fmt"
	"github.com/knackwurstking/pgpress/internal/env"
	"github.com/knackwurstking/pgpress/pkg/models"
)

type ToolAnchorOptions struct {
	EnableStatusBadge  bool
	EnableBindingBadge bool
	EnableTotalCycles  bool
}

// TODO: Need some kind of a resolved tool type which includes the binding information from the tool
templ ToolAnchor(tool *models.ResolvedTool, options *ToolAnchorOptions) {
	{{
		if options == nil {
			options = &ToolAnchorOptions{}
		}
	}}
	<a
		role="button"
		class="outline contrast flex justify-between items-center p"
		href={ fmt.Sprintf("%s/tools/tool/%d",
			env.ServerPathPrefix, tool.ID) }
	>
		<span class="flex gap justify-between w-full">
			<span class="flex flex-col gap-sm">
				<span class="text-semibold">
					{ tool.String() }
				</span>
				<span class="flex gap">
					@PositionBadge(tool.Position, "primary text-bold")
					if options.EnableStatusBadge {
						@ToolStatusBadge(tool.Tool)
					}
				</span>
				if tool.Position == models.PositionTop && tool.IsBound() {
					// TODO: Show the name of the cassette this is pointing to
					<span class="text-sm">{ *tool.Binding }</span>
				}
			</span>
			if options.EnableTotalCycles {
				<span
					class="total-cycles-container flex justify-end items-center w-full pr text-sm"
					hx-get={ fmt.Sprintf(
						"%s/htmx/tools/total-cycles?tool_id=%d&tool_position=%s&input=false",
						env.ServerPathPrefix, tool.ID, tool.Position,
					) }
					hx-trigger="load"
					hx-swap="innerHTML"
					hx-on:htmx:response-error="alert(event.detail.xhr.responseText)"
				></span>
			}
		</span>
		<i class="bi bi-chevron-right"></i>
	</a>
}
