package templates

import "github.com/knackwurstking/pgpress/internal/web/shared/layouts"
import "github.com/knackwurstking/pgpress/internal/web/shared/components"
import "github.com/knackwurstking/pgpress/internal/env"

templ MarkdownHelpPage() {
	@layouts.Main(layouts.MainOptions{
		PageTitle:      "Markdown Hilfe",
		AppBarTitle:    "Markdown Hilfe",
		AdditionalHead: helpStyles(),
		NavContent:     helpNavContent(),
	}) {
		<main class="container py-lg">
			<div class="max-w-4xl mx-auto">
				<header class="mb-xl">
					<h1 class="text-2xl text-bold mb-sm flex items-center">
						<i class="bi bi-markdown mr-sm primary"></i>
						Markdown Hilfe
					</h1>
					<p class="text-lg muted">
						Eine vollständige Übersicht aller unterstützten Markdown-Funktionen mit Beispielen und Live-Vorschau.
					</p>
				</header>

				<div class="space-y-lg">
					<!-- Quick Reference Card -->
					<section class="card elevated p-lg">
						<h2 class="text-xl text-bold mb-md flex items-center primary">
							<i class="bi bi-lightning mr-sm"></i>
							Schnellreferenz
						</h2>
						<div class="grid gap-sm">
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm">**Fett**</code>
								<span class="muted">→</span>
								<strong>Fett</strong>
							</div>
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm">*Kursiv*</code>
								<span class="muted">→</span>
								<em>Kursiv</em>
							</div>
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm">__Unterstrichen__</code>
								<span class="muted">→</span>
								<u>Unterstrichen</u>
							</div>
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm">`Code`</code>
								<span class="muted">→</span>
								<code class="muted px-xs rounded">Code</code>
							</div>
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm"># Überschrift 1</code>
								<span class="muted">→</span>
								<strong class="text-xl">Überschrift 1</strong>
							</div>
							<div class="flex items-center justify-between p-sm border rounded">
								<code class="contrast px-sm py-xs rounded text-sm">## Überschrift 2</code>
								<span class="muted">→</span>
								<strong class="text-lg">Überschrift 2</strong>
							</div>
						</div>
					</section>

					<!-- Interactive Demo -->
					<section class="card elevated p-lg">
						<h2 class="text-xl text-bold mb-md flex items-center success">
							<i class="bi bi-play-circle mr-sm"></i>
							Interaktive Vorschau
						</h2>
						<p class="muted mb-md">
							Probieren Sie verschiedene Markdown-Syntaxen aus und sehen Sie das Ergebnis in Echtzeit:
						</p>
						<div class="demo-grid gap-lg">
							<div>
								<label for="demo-textarea" class="text-sm text-medium mb-sm block">Markdown eingeben:</label>
								<textarea
									id="demo-textarea"
									class="w-full border rounded p-sm text-sm resize-y"
									style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;"
									rows="8"
									placeholder="Hier können Sie Markdown ausprobieren..."
								>
# Willkommen bei Markdown!

Dies ist ein **Beispieltext** mit verschiedenen Formatierungen:

- *Kursiver Text*
- __Unterstrichener Text__
- `Inline-Code`

> Ein Blockzitat für wichtige Informationen.

Und natürlich `Inline-Code` für technische Begriffe.
								</textarea>
							</div>
							<div>
								<label class="text-sm text-medium mb-sm block">Vorschau:</label>
								<div id="demo-preview" class="border rounded p-sm overflow-y-auto markdown-content" style="min-height: 200px; max-height: 300px;">
									<!-- Live preview will be rendered here -->
								</div>
							</div>
						</div>
					</section>

					<!-- Detailed Feature Documentation -->
					<div class="space-y-lg">
						<!-- Text Formatting -->
						<div class="card outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center info">
								<i class="bi bi-type mr-sm"></i>
								Textformatierung
							</h2>

							<div class="space-y-md">
								<div class="pb-md border-bottom">
									<h3 class="text-lg text-medium mb-sm">Fetter Text</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">**Dies ist fetter Text**</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="**Dies ist fetter Text**">
											@components.Spinner()
										</div>
									</div>
									<p class="text-sm muted">
										Verwenden Sie doppelte Sterne (**) um Text fett zu formatieren.
									</p>
								</div>

								<div class="pb-md border-bottom">
									<h3 class="text-lg text-medium mb-sm">Kursiver Text</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">*Dies ist kursiver Text*</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="*Dies ist kursiver Text*">
											@components.Spinner()
										</div>
									</div>
									<p class="text-sm muted">
										Verwenden Sie einzelne Sterne (*) um Text kursiv zu formatieren.
									</p>
								</div>

								<div class="pb-md border-bottom">
									<h3 class="text-lg text-medium mb-sm">Unterstrichener Text</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">__Dies ist unterstrichener Text__</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="__Dies ist unterstrichener Text__">
											@components.Spinner()
										</div>
									</div>
									<p class="text-sm muted">
										Verwenden Sie doppelte Unterstriche (__) um Text zu unterstreichen.
									</p>
								</div>

								<div>
									<h3 class="text-lg text-medium mb-sm">Durchgestrichener Text</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">~~Dies ist durchgestrichener Text~~</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="~~Dies ist durchgestrichener Text~~">
											@components.Spinner()
										</div>
									</div>
									<p class="text-sm muted">
										Verwenden Sie doppelte Tilden (~~) um Text durchzustreichen.
									</p>
								</div>
							</div>
						</div>

						<!-- Headers -->
						<div class="card outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center primary">
								<i class="bi bi-card-heading mr-sm"></i>
								Überschriften
							</h2>

							<div class="space-y-md">
								<div class="example-grid gap-md">
									<div class="muted outline rounded p-sm">
										<code class="text-sm">
											# Überschrift 1
											## Überschrift 2
											### Überschrift 3
											#### Überschrift 4
											##### Überschrift 5
											###### Überschrift 6
										</code>
									</div>
									<div class="border rounded p-sm markdown-content" data-markdown-content="# Überschrift 1\n## Überschrift 2\n### Überschrift 3\n#### Überschrift 4\n##### Überschrift 5\n###### Überschrift 6">
										@components.Spinner()
									</div>
								</div>
							</div>
						</div>

						<!-- Lists -->
						<div class="card outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center secondary">
								<i class="bi bi-list-ul mr-sm"></i>
								Listen
							</h2>

							<div class="space-y-md">
								<div class="pb-md border-bottom">
									<h3 class="text-lg text-medium mb-sm">Ungeordnete Liste</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">
												- Erstes Element
												- Zweites Element
												  - Unterelement
												- Drittes Element
											</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="- Erstes Element\n- Zweites Element\n  - Unterelement\n- Drittes Element">
											@components.Spinner()
										</div>
									</div>
								</div>

								<div>
									<h3 class="text-lg text-medium mb-sm">Geordnete Liste</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">
												1. Erstes Element
												2. Zweites Element
												   1. Unterelement
												3. Drittes Element
											</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="1. Erstes Element\n2. Zweites Element\n   1. Unterelement\n3. Drittes Element">
											@components.Spinner()
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Code -->
						<div class="card outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center warning">
								<i class="bi bi-code-slash mr-sm"></i>
								Code
							</h2>

							<div class="space-y-md">
								<div class="pb-md border-bottom">
									<h3 class="text-lg text-medium mb-sm">Inline-Code</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">`print("Hallo")`</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="`print(\"Hallo\")`">
											@components.Spinner()
										</div>
									</div>
								</div>

								<div>
									<h3 class="text-lg text-medium mb-sm">Code-Block</h3>
									<div class="example-grid gap-md mb-sm">
										<div class="muted outline rounded p-sm">
											<code class="text-sm">```python
print("Hallo Welt!")
```</code>
										</div>
										<div class="border rounded p-sm markdown-content" data-markdown-content="```python\nprint(\"Hallo Welt!\")\n```">
											@components.Spinner()
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Links -->
						<div class="card outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center info">
								<i class="bi bi-link-45deg mr-sm"></i>
								Links
							</h2>

							<div class="example-grid gap-md">
								<div class="muted outline rounded p-sm">
									<code class="text-sm">[Link-Text](https://example.com)</code>
								</div>
								<div class="border rounded p-sm markdown-content" data-markdown-content="[Link-Text](https://example.com)">
									@components.Spinner()
								</div>
							</div>
						</div>

						<!-- Tips and Common Mistakes -->
						<div class="card success outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center success">
								<i class="bi bi-lightbulb mr-sm"></i>
								Tipps & Häufige Fehler
							</h2>

							<div class="space-y-md">
								<div class="flex items-start gap-sm">
									<i class="bi bi-check-circle-fill success text-lg mt-xs"></i>
									<div>
										<strong class="text-medium">Leerzeichen beachten:</strong>
										<span class="text-sm muted block">
											Achten Sie auf Leerzeichen vor und nach Formatierungszeichen für beste Ergebnisse.
										</span>
									</div>
								</div>
								<div class="flex items-start gap-sm">
									<i class="bi bi-check-circle-fill success text-lg mt-xs"></i>
									<div>
										<strong class="text-medium">Zeilen trennen:</strong>
										<span class="text-sm muted block">
											Verwenden Sie Leerzeilen zwischen verschiedenen Elementen für bessere Lesbarkeit.
										</span>
									</div>
								</div>
								<div class="flex items-start gap-sm">
									<i class="bi bi-x-circle-fill destructive text-lg mt-xs"></i>
									<div>
										<strong class="text-medium">Häufiger Fehler:</strong>
										<span class="text-sm muted block mb-xs">
											Vergessen der Leerzeichen nach # bei Überschriften.
										</span>
										<div class="flex flex-col gap-xs">
											<div class="flex items-center gap-sm">
												<i class="bi bi-x-circle destructive"></i>
												<code class="destructive outline px-xs rounded text-sm">#Falsch</code>
											</div>
											<div class="flex items-center gap-sm">
												<i class="bi bi-check-circle success"></i>
												<code class="success outline px-xs rounded text-sm"># Richtig</code>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Keyboard Shortcuts -->
						<div class="card contrast outline p-lg">
							<h2 class="text-xl text-bold mb-md flex items-center contrast">
								<i class="bi bi-keyboard mr-sm"></i>
								Tastenkürzel
							</h2>

							<div class="grid gap-md">
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-sm">
										<i class="bi bi-command contrast"></i>
										<code class="contrast px-sm py-xs rounded text-sm">Ctrl + B</code>
									</div>
									<strong>Fett markieren</strong>
								</div>
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-sm">
										<i class="bi bi-command contrast"></i>
										<code class="contrast px-sm py-xs rounded text-sm">Ctrl + I</code>
									</div>
									<strong>Kursiv markieren</strong>
								</div>
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-sm">
										<i class="bi bi-command contrast"></i>
										<code class="contrast px-sm py-xs rounded text-sm">Ctrl + K</code>
									</div>
									<strong>Link einfügen</strong>
								</div>
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-sm">
										<i class="bi bi-command contrast"></i>
										<code class="contrast px-sm py-xs rounded text-sm">Ctrl + `</code>
									</div>
									<strong>Inline-Code</strong>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		@components.MarkdownScript()
	}
}

templ helpNavContent() {
	<div class="flex items-center gap-sm">
		<a href={ templ.URL(env.ServerPathPrefix + "/") } class="flex items-center gap-xs text-muted hover:text-primary transition-colors">
			<i class="bi bi-house"></i>
			<span class="hidden sm:inline">Startseite</span>
		</a>
	</div>
}

templ helpStyles() {
	@components.MarkdownStyles()
	<style>
		/* Minimal custom styles - most styling uses ui.min.css utilities */
		.help-content {
			line-height: 1.6;
		}

		/* Demo grid layout */
		.demo-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
		}

		@media (max-width: 768px) {
			.demo-grid {
				grid-template-columns: 1fr;
			}
		}

		/* Example grid layout */
		.example-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			align-items: start;
		}

		@media (max-width: 768px) {
			.example-grid {
				grid-template-columns: 1fr;
			}
		}

		/* Space utilities not in ui.min.css */
		.space-y-lg > * + * {
			margin-top: 2rem;
		}

		.space-y-md > * + * {
			margin-top: 1rem;
		}

		.space-y-sm > * + * {
			margin-top: 0.5rem;
		}

		/* Border utilities */
		.border-bottom {
			border-bottom: 1px solid var(--ui-border-subtle);
		}

		/* Background utilities for better contrast */
		.bg-subtle {
			background: var(--ui-bg-subtle);
		}
	</style>
}

templ helpScripts() {
	<script>
		// Live demo preview functionality
		function updateDemoPreview() {
			var textarea = document.getElementById('demo-textarea');
			var preview = document.getElementById('demo-preview');

			if (!textarea || !preview) return;

			var markdown = textarea.value;

			// This would integrate with your markdown parser
			// For now, just show the raw text
			preview.innerHTML = '<pre class="text-sm">' + escapeHtml(markdown) + '</pre>';
		}

		function escapeHtml(text) {
			var map = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#039;'
			};
			return text.replace(/[&<>"']/g, function(m) { return map[m]; });
		}

		document.addEventListener('DOMContentLoaded', function() {
			var textarea = document.getElementById('demo-textarea');
			if (textarea) {
				// Update preview on input
				textarea.addEventListener('input', updateDemoPreview);

				// Initial preview
				updateDemoPreview();
			}

			// Initialize all markdown content areas
			var markdownElements = document.querySelectorAll('[data-markdown-content]');
			for (var i = 0; i < markdownElements.length; i++) {
				var element = markdownElements[i];
				var content = element.getAttribute('data-markdown-content');
				if (content) {
					// Replace spinner with actual content
					// This would integrate with your markdown parser
					element.innerHTML = '<div class="text-sm">' + escapeHtml(content) + '</div>';
				}
			}
		});
	</script>
}
