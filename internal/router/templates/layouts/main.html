<!doctype html>
<html lang="de">
    <head>
        <meta charset="utf-8" />

        <!-- Viewport and responsive design -->
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, user-scalable=yes"
        />

        <!-- PWA and mobile optimization -->
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="pgpress" />
        <meta name="application-name" content="pgpress" />
        <meta name="msapplication-TileColor" content="#3e3c49" />
        <meta name="theme-color" content="#000000" />

        <!-- Icons and manifest -->
        <link rel="icon" href="./favicon.ico" sizes="any" />
        <link rel="icon" href="./icon.png" type="image/png" />
        <link rel="apple-touch-icon" href="./apple-touch-icon-180x180.png" />
        <link rel="mask-icon" href="./icon.png" color="#3e3c49" />

        <!-- PWA Manifest -->
        <link rel="manifest" href="./manifest.json" />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="./css/bootstrap-icons.min.css" />
        <link rel="stylesheet" href="./css/ui.min.css" />
        <link rel="stylesheet" href="./css/layout.css" />

        <!-- Preconnect for performance -->
        <link rel="dns-prefetch" href="//fonts.googleapis.com" />

        <style>
            /* Prevent Safari zoom on input focus */
            input[type="text"],
            input[type="email"],
            input[type="password"],
            input[type="number"],
            input[type="tel"],
            input[type="url"],
            input[type="search"],
            textarea,
            select {
                font-size: 16px !important;
                transform-origin: left top;
                font-family: inherit;
            }
        </style>

        <title>{{block "title" .}}pgpress{{end}}</title>

        <!-- HTMX for dynamic content -->
        <script src="./js/htmx-v2.0.6.min.js"></script>
        <script src="./js/htmx-ext-ws-v2.0.3.min.js"></script>

        <script>
        function openImageViewer(attachmentID) {
            var imageURL = `./trouble-reports/attachments?attachment_id=${attachmentID}`;
            var imageViewer = document.querySelector('template[name="image-viewer"]');
            var dialog = imageViewer.content.cloneNode(true).querySelector('dialog');
            var img = dialog.querySelector('img.attachment');
            var closeButton = dialog.querySelector('button.close');

            console.debug(`Opening image viewer with image ${imageURL}`);

            img.src = imageURL;
            img.onclick = function(event) {
                event.stopPropagation();
            };

            dialog.onclick = function() {
                dialog.close();
            };

            closeButton.onclick = function() {
                dialog.close();
            };

            dialog.onclose = function(event) {
                document.body.removeChild(dialog);
            };

            document.body.appendChild(dialog);
            dialog.showModal();
        }
        </script>

        {{block "head" .}}{{end}}
    </head>

    <body hx-ext="ws">
        <header class="container fluid">
            <nav class="flex row gap justify-between">
                <div class="flex row gap justify-start align-center">
                    <div>
                        <h5>{{block "app-bar-title" .}}pgpress{{end}}</h5>
                    </div>
                </div>

                {{block "nav" .}}{{end}}
            </nav>
        </header>

        <main>{{block "content" .}}{{end}}</main>

        <template name="image-viewer">
            <dialog class="image-viewer fullscreen clean flex justify-center align-center">
                <img alt="Attachment" class="attachment" />

                <button
                    type="button"
                    class="close icon secondary ghost"
                    onclick="this.closest('dialog').close()"
                    title="SchlieÃŸen"
                >
                    <i class="bi bi-x-lg"></i>
                </button>
            </dialog>
        </template>
    </body>
</html>

{{define "basic-nav-elements"}}
<div class="flex row gap justify-end align-center">
    {{template "nav-feed"}}

    <a
        role="button"
        class="ghost contrast icon"
        href="./profile"
        title="Profil"
    >
        <i class="bi bi-person-circle"></i>
    </a>

    <a role="button" class="ghost contrast icon" href="./" title="Startseite">
        <i class="bi bi-house"></i>
    </a>
</div>
{{end}}
