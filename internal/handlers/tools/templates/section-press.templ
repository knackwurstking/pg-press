package templates

import (
	"fmt"
	"github.com/knackwurstking/pg-press/internal/components"
	"github.com/knackwurstking/pg-press/internal/components/badge"
	"github.com/knackwurstking/pg-press/internal/components/button"
	"github.com/knackwurstking/pg-press/internal/components/icon"
	"github.com/knackwurstking/pg-press/internal/shared"
	"github.com/knackwurstking/pg-press/internal/urlb"
)

type SectionPressProps struct {
	PressUtilizations      map[shared.EntityID]*shared.PressUtilization
	PressUtilizationsOrder []shared.EntityID
	User                   *shared.User
}

templ SectionPress(p SectionPressProps) {
	<span
		hx-get={ urlb.ToolsSectionPress() }
		hx-trigger="press-tab-content from:body"
		hx-target="#press-tab-content"
	></span>
	@components.ActionBar() {
		@button.Button(button.Props{
			Size: button.SizeSm,
			Attributes: templ.Attributes{
				"hx-get":     string(urlb.DialogEditPressGet(-1)),
				"hx-trigger": "click",
				"hx-target":  "body",
				"hx-swap":    "beforeend",
			},
			Disabled: !p.User.IsAdmin(),
		}) {
			@icon.Plus()
			Presse Hinzuf√ºgen
		}
	}
	<div id="press-container" class="flex flex-col gap-4">
		for _, e := range p.PressUtilizationsOrder {
			{{ u := p.PressUtilizations[e] }}
			@listPressItem(u)
		}
	</div>
}

templ listPressItem(p *shared.PressUtilization) {
	{{ title := p.Press().German() }}
	<div class="press-container flex flex-col gap-4">
		@button.Button(button.Props{
			Class:   "h-fit",
			Variant: button.VariantOutline,
			Href:    string(urlb.Press(p.PressID)),
		}) {
			<span class="flex flex-col gap-6 w-full">
				<h5 class="text-primary">{ title }</h5>
				<span class="flex flex-wrap gap-4 justify-between items-center w-full">
					if p.SlotUpper != nil || p.SlotUpperCassette != nil {
						<!-- Upper Tool -->
						<span class="flex flex-col gap-4">
							if p.SlotUpper != nil {
								{{
									text := fmt.Sprintf("%dx%d %s %s",
										p.SlotUpper.Width, p.SlotUpper.Height,
										p.SlotUpper.Code,
										p.SlotUpper.Type,
									)
								}}
								<span class="flex flex-col justify-center items-start gap-1">
									@badge.Badge(badge.Props{
										Class:   "text-bold",
										Variant: badge.VariantSecondary,
									}) {
										{ shared.SlotUpper.German() }
									}
									<small class="text-sm">{ text }</small>
								</span>
							}
							if p.SlotUpperCassette != nil {
								{{
									text := fmt.Sprintf("%dx%d %s %s %.1fmm -> %.1fmm",
										p.SlotUpperCassette.Width, p.SlotUpperCassette.Height,
										p.SlotUpperCassette.Code,
										p.SlotUpperCassette.Type,
										p.SlotUpperCassette.MinThickness,
										p.SlotUpperCassette.MaxThickness,
									)
								}}
								<span class="flex flex-col justify-center items-start gap-1">
									@badge.Badge(badge.Props{
										Class:   "text-bold",
										Variant: badge.VariantSecondary,
									}) {
										{ shared.SlotUpperCassette.German() }
									}
									<small class="text-sm">{ text }</small>
								</span>
							}
						</span>
					}
					if p.SlotLower != nil {
						{{
							text := fmt.Sprintf("%dx%d %s %s",
								p.SlotUpper.Width, p.SlotUpper.Height,
								p.SlotUpper.Code,
								p.SlotUpper.Type,
							)
						}}
						<!-- Lower Tool -->
						<span class="flex flex-col justify-center items-start gap-1">
							@badge.Badge(badge.Props{
								Class:   "text-bold",
								Variant: badge.VariantSecondary,
							}) {
								{ shared.SlotLower.German() }
							}
							<small class="text-sm">{ text }</small>
						</span>
					}
				</span>
			</span>
		}
	</div>
}
