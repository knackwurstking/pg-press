package templates

import (
	"fmt"

	"github.com/knackwurstking/pg-press/internal/components/icon"
	"github.com/knackwurstking/pg-press/internal/urlb"
)

templ AttachmentsPreview(attachments []string) {
	if len(attachments) > 0 {
		<div class="attachments-preview border p-4 rounded bg-muted text-muted-foreground">
			<div class="attachments-preview-label flex gap-2 items-center select-none">
				@icon.Paperclip()
				Bilder ({ len(attachments) })
			</div>
			<div class="attachments-preview-scroll flex gap-4 overflow-x-auto p-4">
				for _, a := range attachments {
					@attachmentPreviewItem(a)
				}
			</div>
		</div>
	}
}

templ attachmentPreviewItem(attachment string) {
	{{ src := urlb.Attachment(attachment) }}
	<div
		class="attachment-preview-item cursor-pointer"
		onclick={ openImageViewer(src) }
		tabindex="0"
		role="button"
		aria-label={ fmt.Sprintf("Bild \"%s\" anzeigen", attachment) }
	>
		<div class="attachment-preview-image w-24 h-24 overflow-hidden rounded">
			<img
				loading="lazy"
				src={ src }
				alt={ fmt.Sprintf("Anhang \"%s\"", attachment) }
				class="preview-thumbnail select-none object-cover w-full h-full"
			/>
		</div>
	</div>
}

script openImageViewer(url templ.SafeURL) {
	openImageViewer(url);
}
